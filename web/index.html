<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007AFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>LANShare P2P - {{.Name}}</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>💬</text></svg>">
</head>

<body>
    <canvas id="canvas"></canvas>
    <div class="container">
        <!-- 苹果风格头部 -->
        <div class="header">
            <h1>LANShare P2P</h1>
            <p>用户: {{.Name}} | IP: {{.LocalIP}}:{{.LocalPort}}</p>
        </div>

        <!-- 主内容区域 -->
        <div class="main">
            <!-- 侧边栏 -->
            <div class="sidebar">
                <div class="status" id="statusIndicator">
                    状态: 已连接
                </div>

                <div class="users-section">
                    <!-- <h3>👥 聊天</h3> -->
                    <ul class="users-list" id="usersList">
                        <li id="public-chat-btn" class="chat-channel active" data-chat-id="all" data-chat-name="公聊">🌐
                            公聊</li>
                        <hr class="divider">
                        <!-- 在线用户将由JS动态插入 -->
                    </ul>
                </div>

                <!-- 文件传输状态区域 -->
                <div class="file-transfers-section" id="fileTransfersSection" style="display: none;">
                    <h4>📁 文件传输</h4>
                    <div id="fileTransfersList"></div>
                </div>

            </div>
            <div class="chat-area">
                <!-- 消息区域 -->
                <div class="messages" id="messages">
                    <div class="welcome-message">
                        <div class="message other">
                            <div class="message-sender">系统</div>
                            <div class="message-content">欢迎使用 LANShare P2P！开始聊天吧 🎉</div>
                            <div class="message-time" id="welcomeTime"></div>
                        </div>
                    </div>
                </div>

                <!-- 输入区域 -->
                <div class="input-area">
                    <div id="emoji-picker" class="emoji-picker" style="display: none;">
                        <!-- 表情将由JS动态填充 -->
                    </div>
                    <div id="file-transfer-controls" class="file-transfer-controls" style="display: none;">
                        <span id="fileNameDisplay" class="file-name-display"></span>
                        <select id="fileTargetUser" class="user-select">
                            <option value="">选择接收文件的用户</option>
                        </select>
                        <button onclick="sendFile()" id="sendFileBtn" class="send-file-btn" disabled>发送文件</button>
                        <button onclick="cancelFileSelection()" id="cancelFileBtn" class="cancel-btn">取消</button>
                    </div>
                    <div class="input-group">
                        <input type="text" id="messageInput" placeholder="输入消息..." onkeypress="handleKeyPress(event)"
                            autocomplete="off">
                        <input type="file" id="fileInput" style="display: none;" accept="*/*">
                        <input type="file" id="imageInput" style="display: none;" accept="image/*">
                        <button id="emoji-button" class="emoji-btn">😀</button>
                        <button onclick="document.getElementById('imageInput').click()" class="image-select-btn"
                            title="选择图片">
                            📷
                        </button>
                        <button onclick="document.getElementById('fileInput').click()" class="file-select-btn"
                            title="选择文件">
                            📎
                        </button>
                        <button onclick="sendMessage()" id="sendButton">
                            <span class="button-text">发送</span>
                            <span class="loading-indicator" style="display: none;">⏳</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 聊天区域 -->

    </div>
    </div>

    <!-- 文件接收确认弹窗 -->
    <div id="file-confirm-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-box">
            <h4>文件接收请求</h4>
            <p>您收到一个文件传输请求：</p>
            <div class="file-info">
                <strong>文件名:</strong> <span id="dialog-filename"></span><br>
                <strong>大小:</strong> <span id="dialog-filesize"></span><br>
                <strong>来自:</strong> <span id="dialog-sender"></span>
            </div>
            <div class="dialog-buttons">
                <button id="dialog-reject-btn" class="dialog-btn reject">拒绝</button>
                <button id="dialog-accept-btn" class="dialog-btn accept">接受</button>
            </div>
        </div>
    </div>

    <!-- 自定义警报弹窗 -->
    <div id="emoji-alert-dialog" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div id="alert-message" class="alert-message"></div>
            <button id="alert-ok-btn" class="alert-ok-btn">确定</button>
        </div>
    </div>

    <script src="/static/app.js"></script>
    <script>
        // 设置欢迎消息时间
        document.getElementById('welcomeTime').textContent = new Date().toLocaleTimeString('zh-CN', {
            hour12: false,
            hour: '2-digit',
            minute: '2-digit'
        });
        // 初始化应用
        init();
    </script>
</body>

<script src="/static/canvasBg.js"></script>

</html>