<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#17212b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>LS Messager - {{.Name}}</title>
    <link rel="stylesheet" href="/static/style-base.css">
    <script>
        // Anti-flash: inject correct theme CSS before first paint (render-blocking)
        var __theme = 'telegram';
        try { var s = JSON.parse(localStorage.getItem('lanshare_settings')||'{}');
              if (s.skin) __theme = s.skin; } catch(e) {}
        document.write('<link rel="stylesheet" id="themeCSS" href="/static/theme-' + __theme + '.css">');
    </script>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí¨</text></svg>">
</head>

<body>
    <div id="app" class="tg-app">
        <!-- Top banner container (pushes everything down) -->
        <div id="bannerContainer" class="tg-banner-container"></div>

        <div class="tg-app-body">
        <!-- Left Panel: Chat List / Settings -->
        <div class="tg-sidebar">
            <!-- Chat list view (default) -->
            <div id="sidebarMain" class="tg-sidebar-view">
                <div class="tg-sidebar-header">
                    <div class="tg-search-row">
                        <button class="tg-settings-btn" id="settingsBtn" title="ËÆæÁΩÆ">
                            <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.49.49 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96a.49.49 0 00-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6A3.6 3.6 0 1115.6 12 3.6 3.6 0 0112 15.6z"/></svg>
                        </button>
                        <div class="tg-search-wrap">
                            <span class="tg-search-icon">üîç</span>
                            <input type="text" id="searchInput" class="tg-search-input" placeholder="ÊêúÁ¥¢ËÅäÂ§©..." autocomplete="off">
                        </div>
                    </div>
                </div>
                <div id="chatList" class="tg-chat-list">
                    <!-- Chat list items will be rendered by JS -->
                </div>
                <!-- Update banner -->
                <div id="updateBanner" class="tg-update-banner" style="display: none;">
                    <span id="updateBannerText">ÂèëÁé∞Êñ∞ÁâàÊú¨</span>
                    <button id="updateBannerBtn" class="tg-update-btn">Êõ¥Êñ∞</button>
                </div>
                <div class="tg-sidebar-footer">
                    <div class="tg-status" id="statusIndicator">
                        <span class="tg-status-dot online"></span>
                        <span class="tg-status-text">Â∑≤ËøûÊé•</span>
                    </div>
                    <div class="tg-user-info">{{.Name}} ¬∑ {{.LocalIP}}</div>
                </div>
            </div>

            <!-- Settings view (hidden by default) -->
            <div id="sidebarSettings" class="tg-sidebar-view" style="display: none;">
                <div class="tg-sidebar-header tg-settings-header">
                    <button class="tg-settings-back-btn" id="settingsBackBtn" title="ËøîÂõû">
                        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                    </button>
                    <span class="tg-settings-title">ËÆæÁΩÆ</span>
                </div>
                <div class="tg-settings-body">
                    <!-- Profile -->
                    <div class="tg-settings-section">
                        <div class="tg-settings-section-title">‰∏™‰∫∫‰ø°ÊÅØ</div>
                        <div class="tg-settings-item tg-settings-input-row">
                            <label class="tg-settings-label">Áß∞Âëº</label>
                            <input type="text" id="settingUsername" class="tg-settings-input" placeholder="ËæìÂÖ•Áß∞Âëº..." maxlength="20">
                        </div>
                    </div>
                    <!-- Display -->
                    <div class="tg-settings-section">
                        <div class="tg-settings-section-title">ÊòæÁ§∫</div>
                        <div class="tg-settings-item tg-settings-toggle-row">
                            <label class="tg-settings-label">Â≠ó‰ΩìÂ§ßÂ∞è</label>
                            <div class="tg-settings-font-row">
                                <button class="tg-font-btn" id="fontDecBtn">A-</button>
                                <span id="fontSizeDisplay" class="tg-font-display">15</span>
                                <button class="tg-font-btn" id="fontIncBtn">A+</button>
                            </div>
                        </div>
                    </div>
                    <!-- Skin -->
                    <div class="tg-settings-section">
                        <div class="tg-settings-section-title">ÁöÆËÇ§</div>
                        <div class="tg-settings-item">
                            <div class="tg-skin-options" id="skinOptions">
                                <div class="tg-skin-option active" data-skin="telegram">
                                    <div class="tg-skin-preview telegram">
                                        <div class="tg-skin-sidebar"></div>
                                        <div class="tg-skin-chat">
                                            <div class="tg-skin-bubble"></div>
                                            <div class="tg-skin-bubble"></div>
                                        </div>
                                    </div>
                                    <span class="tg-skin-label">Ê∑±Ëâ≤</span>
                                </div>
                                <div class="tg-skin-option" data-skin="wisetalk">
                                    <div class="tg-skin-preview wisetalk">
                                        <div class="tg-skin-sidebar"></div>
                                        <div class="tg-skin-chat">
                                            <div class="tg-skin-bubble"></div>
                                            <div class="tg-skin-bubble"></div>
                                        </div>
                                    </div>
                                    <span class="tg-skin-label">Âç≥Êó∂ÈÄö</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Notifications -->
                    <div class="tg-settings-section">
                        <div class="tg-settings-section-title">ÈÄöÁü•</div>
                        <div class="tg-settings-item tg-settings-toggle-row">
                            <label class="tg-settings-label">Ê∂àÊÅØÈÄöÁü•</label>
                            <label class="tg-toggle">
                                <input type="checkbox" id="settingMsgNotify" checked>
                                <span class="tg-toggle-slider"></span>
                            </label>
                        </div>
                        <div class="tg-settings-item tg-settings-toggle-row">
                            <label class="tg-settings-label">‰∏äÁ∫øÈÄöÁü•</label>
                            <label class="tg-toggle">
                                <input type="checkbox" id="settingOnlineNotify" checked>
                                <span class="tg-toggle-slider"></span>
                            </label>
                        </div>
                        <div class="tg-settings-item tg-settings-toggle-row">
                            <label class="tg-settings-label">ÂõæÊ†áÊòæÁ§∫Êú™ËØªËÆ°Êï∞</label>
                            <label class="tg-toggle">
                                <input type="checkbox" id="settingBadgeCount" checked>
                                <span class="tg-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <!-- Storage -->
                    <div class="tg-settings-section">
                        <div class="tg-settings-section-title">Â≠òÂÇ®</div>
                        <div class="tg-settings-item tg-settings-toggle-row">
                            <label class="tg-settings-label">‰øùÂ≠òËÅäÂ§©ËÆ∞ÂΩï</label>
                            <label class="tg-toggle">
                                <input type="checkbox" id="settingSaveHistory" checked>
                                <span class="tg-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    <!-- Advanced -->
                    <div class="tg-settings-section">
                        <div class="tg-settings-section-title">È´òÁ∫ß</div>
                        <div class="tg-settings-item tg-settings-toggle-row">
                            <label class="tg-settings-label">Êó•ÂøóÁ∫ßÂà´</label>
                            <select id="settingLogLevel" class="tg-settings-select">
                                <option value="error">Error</option>
                                <option value="info">Info</option>
                                <option value="debug">Debug</option>
                            </select>
                        </div>
                        <div class="tg-settings-item tg-settings-toggle-row">
                            <label class="tg-settings-label">Êó•ÂøóÁõÆÂΩï</label>
                            <button class="tg-settings-btn-action" id="openLogDirBtn">üìÇ ÊâìÂºÄ</button>
                        </div>
                    </div>
                </div>
                <div class="tg-sidebar-footer tg-settings-footer">
                    <span class="tg-settings-version" id="settingsVersion"></span>
                </div>
            </div>
        </div>

        <!-- Right Panel: Conversation -->
        <div class="tg-main">
            <!-- Empty state when no chat selected -->
            <div class="tg-main-empty" id="mainEmpty">
                <div class="tg-empty-icon">üí¨</div>
                <div class="tg-empty-text">ÈÄâÊã©‰∏Ä‰∏™ËÅäÂ§©ÂºÄÂßãÂØπËØù</div>
            </div>

            <!-- Active conversation -->
            <div class="tg-conversation" id="conversation" style="display: none;">
                <!-- Conversation header -->
                <div class="tg-conv-header">
                    <button class="tg-back-btn" id="backBtn" title="ËøîÂõû">
                        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                        <span class="tg-back-badge" id="backBadge"></span>
                    </button>
                    <div class="tg-conv-avatar" id="convAvatar"></div>
                    <div class="tg-conv-info">
                        <div class="tg-conv-name" id="convName"></div>
                        <div class="tg-conv-status" id="convStatus"></div>
                    </div>
                    <div class="tg-conv-actions">
                        <button class="tg-action-btn" id="blockToggleBtn" title="Â±èËîΩ/Ëß£Èô§Â±èËîΩ">üö´</button>
                    </div>
                </div>

                <!-- Messages area -->
                <div id="messages" class="tg-messages">
                    <!-- Messages rendered by JS -->
                </div>

                <!-- Drop overlay (shown during drag) -->
                <div id="dropOverlay" class="tg-drop-overlay">
                    <div class="tg-drop-overlay-icon">üìÇ</div>
                    <div class="tg-drop-overlay-text">ÊãñÊîæÊñá‰ª∂Âà∞Ê≠§Â§ÑÂèëÈÄÅ</div>
                </div>

                <!-- Input area -->
                <div class="tg-input-area">
                    <div id="replyIndicator" class="tg-reply-indicator" style="display: none;">
                        <div class="tg-reply-bar"></div>
                        <div class="tg-reply-body">
                            <div class="tg-reply-name" id="replyName"></div>
                            <div class="tg-reply-text" id="replyText"></div>
                        </div>
                        <button class="tg-reply-close" id="replyCloseBtn">‚úï</button>
                    </div>
                    <div id="emojiPicker" class="tg-emoji-picker" style="display: none;">
                        <!-- Emoji grid rendered by JS -->
                    </div>
                    <!-- File transfer controls -->
                    <div id="file-transfer-controls" class="tg-file-controls" style="display: none;">
                        <span id="fileNameDisplay" class="tg-file-name-display"></span>
                        <select id="fileTargetUser" class="tg-user-select">
                            <option value="">ÈÄâÊã©Êé•Êî∂ËÄÖ</option>
                        </select>
                        <button onclick="sendFile()" id="sendFileBtn" class="tg-file-send-btn" disabled>ÂèëÈÄÅ</button>
                        <button onclick="cancelFileSelection()" id="cancelFileBtn" class="tg-file-cancel-btn">ÂèñÊ∂à</button>
                    </div>
                    <div id="mentionDropdown" class="tg-mention-dropdown"></div>
                    <div class="tg-input-row">
                        <button class="tg-attach-btn" id="attachBtn" title="ÈôÑ‰ª∂">
                            <span class="tg-attach-icon">üìé</span>
                        </button>
                        <div class="tg-attach-menu" id="attachMenu" style="display: none;">
                            <button class="tg-attach-option" id="attachImageBtn">üì∑ ÂõæÁâá</button>
                            <button class="tg-attach-option" id="attachFileBtn">üìÅ Êñá‰ª∂</button>
                        </div>
                        <textarea id="messageInput" class="tg-msg-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." autocomplete="off" rows="1"></textarea>
                        <input type="file" id="fileInput" style="display: none;" accept="*/*">
                        <input type="file" id="imageInput" style="display: none;" accept="image/*">
                        <button class="tg-emoji-btn" id="emojiButton" title="Ë°®ÊÉÖ">üòÄ</button>
                    </div>
                </div>
            </div>
        </div>
        </div><!-- .tg-app-body -->
    </div>

    <!-- Emoji alert dialog -->
    <div id="emoji-alert-dialog" class="tg-dialog-overlay" style="display: none;">
        <div class="tg-dialog-box">
            <div id="alert-message" class="tg-alert-message"></div>
            <button id="alert-ok-btn" class="tg-dialog-btn accept" style="width:100%">Á°ÆÂÆö</button>
        </div>
    </div>

    <!-- Confirm dialog (in-app replacement for browser confirm()) -->
    <div id="confirmDialog" class="tg-dialog-overlay" style="display: none;">
        <div class="tg-dialog-box">
            <div id="confirmMessage" class="tg-alert-message"></div>
            <div class="tg-dialog-buttons">
                <button id="confirmCancelBtn" class="tg-dialog-btn reject">ÂèñÊ∂à</button>
                <button id="confirmOkBtn" class="tg-dialog-btn accept">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- Toast container -->
    <div id="toastContainer" class="tg-toast-container"></div>

    <script>
        // Go template data
        const APP_DATA = {
            name: '{{.Name}}',
            localIP: '{{.LocalIP}}',
            localPort: '{{.LocalPort}}'
        };
    </script>
    <script src="/static/app.js"></script>
    <script>init();</script>
</body>

</html>
